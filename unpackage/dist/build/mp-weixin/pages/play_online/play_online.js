(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/play_online/play_online"],{"15f3":function(e,a,t){"use strict";var n=function(){var e=this,a=e.$createElement;e._self._c},o=[];t.d(a,"a",function(){return n}),t.d(a,"b",function(){return o})},"1a65":function(e,a,t){},"7be1":function(e,a,t){"use strict";(function(e){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("a34a")),o=t("2f62"),l=r(t("b39a"));t("2144");function r(e){return e&&e.__esModule?e:{default:e}}function i(e,a,t,n,o,l,r){try{var i=e[l](r),u=i.value}catch(s){return void t(s)}i.done?a(u):Promise.resolve(u).then(n,o)}function u(e){return function(){var a=this,t=arguments;return new Promise(function(n,o){var l=e.apply(a,t);function r(e){i(l,n,o,r,u,"next",e)}function u(e){i(l,n,o,r,u,"throw",e)}r(void 0)})}}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{},n=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(a){p(e,a,t[a])})}return e}function p(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var c={data:function(){return{loacal_avatarUrl_loc:"../../static/nobody.png",fiveStone:null,winLoc:{whowin:0,whowin_title:"",start:null,end:null,width:null,angle:null},setTime:null,loc1:null,loc:null,data_flag:null,whichplayer:0,shuijishu:null,agree_next_play:!1,next_tablenbr:null,play_group:[{},{player:1,state:"none",player_nickname:null,player_avatarUrl:null},{player:1,state:"none",player_nickname:null,player_avatarUrl:null}],tips_group:{cantouch_flag:!0,mulu_flag:null,show_tips_flag:!0,show_black_tips_flag:!0,get_tips_flag:!0,steps_limit:60,table_name:"",show_wrong_choice_flag:!1,show_tips_last_flag:!1,show_dftx_flag:!1,double_undo_flag:!1,show_qiuzhu_flag:!1,show_find_duishou_flag:!1,show_menu_flag:!1,has_yaoqing_flag:"false",agreeundo_flag:!1},sever_play_data:null}},computed:s({},(0,o.mapState)(["userInfo"])),onShareAppMessage:function(e){return"button"===e.from&&console.log(e.target),{title:"朋友，来一局五子棋",path:"/pages/play_online/play_online?mulu_flag=ljms_hyyz&player=2&shuijishu="+this.shuijishu}},onLoad:function(){var a=u(n.default.mark(function a(t){var o;return n.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:o=this,console.log("初始化棋盘"),o.fiveStone=new l.default(15,.98),o.fiveStone.setWinCallback(o.winCallback),o.loc=null,o.tips_group.mulu_flag=t.mulu_flag,o.tips_group.has_yaoqing_flag=t.has_yaoqing_flag,o.whichplayer=t.player,o.shuijishu=t.shuijishu,console.log(o.tips_group.mulu_flag),a.t0=t.mulu_flag,a.next="ljms_hyyz"===a.t0?13:"ljms_sjpd"===a.t0?20:27;break;case 13:return o.tips_group.show_dftx_flag=3,o.tips_group.get_tips_flag=!1,o.tips_group.show_tips_flag=!1,o.tips_group.show_find_duishou_flag=!0,o.tips_group.show_menu_flag=!0,e.setNavigationBarTitle({title:"巅峰对决"}),a.abrupt("break",28);case 20:return o.tips_group.show_dftx_flag=3,o.tips_group.get_tips_flag=!1,o.tips_group.show_tips_flag=!1,o.tips_group.show_find_duishou_flag=!0,o.tips_group.show_menu_flag=!0,e.setNavigationBarTitle({title:"随机配对"}),a.abrupt("break",28);case 27:return a.abrupt("break",28);case 28:o.$forceUpdate(),o.play_group[o.whichplayer].state="ready",o.update_play_date(),o.setTime=setInterval(function(){o.play_circle()},2e3);case 32:case"end":return a.stop()}},a,this)}));function t(e){return a.apply(this,arguments)}return t}(),methods:s({},(0,o.mapMutations)(["settipslast","cuttipslast","login","logout","setopenid","settipslast","setphonenum","setdbuserifo"]),{handleTip:function(e){this.fiveStone.canStep()&&(this.fiveStone.getStepPosition(e),this.loc=this.fiveStone.getStepLocation(e))},winCallback:function(e){var a=this;a.winLoc.whowin=3-a.fiveStone.stone,1==a.winLoc.whowin&&(a.winLoc.whowin_title="黑胜"),2==a.winLoc.whowin&&(a.winLoc.whowin_title="白胜"),a.whichplayer==a.winLoc.whowin&&(a.play_group[a.whichplayer].state="win",a.update_play_date()),a.whichplayer!=a.winLoc.whowin&&(a.play_group[a.whichplayer].state="loss",a.update_play_date()),a.$forceUpdate(),a.fiveStone.preventStep(),setTimeout(function(){a.restartnewgame()},3e3)},onChessBoardTouchStart:function(e){handleTip(e)},onChessBoardTouchMove:function(e){handleTip(e)},onChessBoardTouchEnd:function(e){if(this.tips_group.cantouch_flag){var a=this;if(a.handleTip(e),null!=a.loc&&null!=a.loc1&&(console.log("loc",a.loc.x,a.loc.y),console.log("loc1",a.loc1.x,a.loc1.y),a.loc1.x==a.loc.x&&a.loc1.y==a.loc.y))return a.fiveStone.step(a.loc.x,a.loc.y),a.update_play_date(),a.loc1.x=100,a.loc1.y=100,a.tips_group.cantouch_flag=!1,void a.$forceUpdate();a.loc1==a.loc&&null!=a.loc1||0!=a.fiveStone.chessBoard[a.loc.x][a.loc.y].stoneType||(a.loc1=JSON.parse(JSON.stringify(a.loc)))}},restart:function(){var a=this;e.showModal({title:"警告",content:"是否确定重新开始，重新开始后本局判输",success:function(e){e.confirm?(a.play_group[a.whichplayer].state="renshu",a.update_play_date(),a.winLoc.whowin=a.fiveStone.stone,a.winLoc.whowin_title="认输",a.winLoc.start=null,a.winLoc.end=null,a.fiveStone.preventStep(),a.$forceUpdate(),setTimeout(function(){a.restartnewgame()},3e3)):e.cancel}})},undo:function(){this.play_group[this.whichplayer].state="huiqi",this.update_play_date(),e.showLoading({mask:!0,title:"等待对方回复"})},tap_jieshao:function(){e.navigateTo({url:"../jieshao/jieshao"})},gotozml:function(){var a=this;e.showModal({title:"警告",content:"是否确定要离开本局游戏，离开后无法继续",success:function(t){t.confirm?(a.play_group[a.whichplayer].state="renshu",clearInterval(a.setTime),a.update_play_date(),e.reLaunch({url:"../index2/index2"})):t.cancel}})},start_play:function(){var a=u(n.default.mark(function a(){var t;return n.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(t=this,"false"!=this.tips_group.has_yaoqing_flag){a.next=6;break}return e.showToast({title:"等待对手中。。。",icon:"none"}),a.abrupt("return");case 6:t.tips_group.show_menu_flag=!1,t.tips_group.cantouch_flag=!1,t.$forceUpdate();case 9:case"end":return a.stop()}},a,this)}));function t(){return a.apply(this,arguments)}return t}(),play_circle:function(){var a=u(n.default.mark(function a(){var t,o;return n.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return t=this,o={form:"get_wzq_dz_data",shuijishu:t.shuijishu},a.next=4,t.download_from_server(o,"sever_play_data");case 4:1==t.whichplayer&&1==t.agree_next_play&&t.sever_play_data[0]["next_tablenbr"].length>5&&(clearInterval(t.setTime),e.reLaunch({url:"../play_online/play_online?mulu_flag=ljms_hyyz&has_yaoqing_flag=true&player=2&shuijishu="+t.sever_play_data[0]["next_tablenbr"]})),t.play_group[1].player_nickname=t.sever_play_data[0].nickName1,t.play_group[1].player_avatarUrl=t.sever_play_data[0].avatarUrl1,t.play_group[2].player_nickname=t.sever_play_data[0].nickName2,t.play_group[2].player_avatarUrl=t.sever_play_data[0].avatarUrl2,1==t.whichplayer&&(t.play_group[2].state=t.sever_play_data[0].state2),2==t.whichplayer&&(t.play_group[1].state=t.sever_play_data[0].state1),t.$forceUpdate(),console.log(t.play_group),(t.fiveStone.chessboard_total_line.length<t.sever_play_data[0].chessboard.length||"agreehuiqi"==t.play_group[3-t.whichplayer].state)&&(console.log("change_history",t.fiveStone.chessboard_total_line),t.fiveStone.changehistory(t.sever_play_data[0].chessboard)),"none"!=t.play_group[3-t.whichplayer].state&&(t.tips_group.has_yaoqing_flag=!0,"renshu"==t.play_group[3-t.whichplayer].state?(t.play_group[t.whichplayer].state,t.update_play_date(),t.winLoc.whowin=t.whichplayer,t.winLoc.whowin_title="对方认输",t.tips_group.cantouch_flag=!1,t.$forceUpdate(),setTimeout(function(){t.restartnewgame()},3e3)):"ok"==t.play_group[3-t.whichplayer].state?(t.play_group[t.whichplayer].state="ok",t.update_play_date(),t.fiveStone.stone==t.whichplayer&&(t.tips_group.cantouch_flag=!0)):"huiqi"==t.play_group[3-t.whichplayer].state&&"agreehuiqi"!=t.play_group[t.whichplayer].state&&"notagreehuiqi"!=t.play_group[t.whichplayer].state?e.showModal({content:"对方请求悔棋是否同意？",success:function(e){e.confirm?(t.fiveStone.undo(),t.fiveStone.stone==t.whichplayer&&t.fiveStone.undo(),t.winLoc.whowin=0,t.winLoc.whowin_title="",t.winLoc.start=null,t.winLoc.end=null,t.$forceUpdate(),t.play_group[t.whichplayer].state="agreehuiqi",t.update_play_date()):e.cancel&&(t.play_group[t.whichplayer].state="notagreehuiqi",t.update_play_date())}}):"notagreehuiqi"==t.play_group[3-t.whichplayer].state&&"ok"!=t.play_group[t.whichplayer].state?(e.hideLoading(),e.showToast({title:"对方不同意"}),t.play_group[t.whichplayer].state="ok",t.update_play_date()):"agreehuiqi"==t.play_group[3-t.whichplayer].state&&"ok"!=t.play_group[t.whichplayer].state?(e.hideLoading(),e.showToast({title:"对方同意"}),t.play_group[t.whichplayer].state="ok",t.update_play_date()):t.fiveStone.stone==t.whichplayer&&(t.tips_group.cantouch_flag=!0));case 15:case"end":return a.stop()}},a,this)}));function t(){return a.apply(this,arguments)}return t}(),update_play_date:function(){var e=u(n.default.mark(function e(){var a,t;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,"",t="new_wzq_dz_play"+this.whichplayer+"_update",a.upload_to_server({form:t,nickName:a.userInfo.nickName,avatarUrl:a.userInfo.avatarUrl,openid:a.userInfo.openid,shuijishu:a.shuijishu,state:a.play_group[a.whichplayer].state,chessboard:a.fiveStone.chessboard_total_line,next_tablenbr:a.next_tablenbr});case 4:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),restartnewgame:function(){var a=u(n.default.mark(function a(t){var o;return n.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:o=this,e.showModal({content:"是否再来一局？",success:function(a){if(a.confirm){if(o.agree_next_play=!0,1==o.whichplayer)o.sever_play_data[0]["next_tablenbr"].length>5&&e.reLaunch({url:"../play_online/play_online?mulu_flag=ljms_hyyz&has_yaoqing_flag=true&player=2&shuijishu="+o.sever_play_data[0]["next_tablenbr"]});else if(2==o.whichplayer){var t=Math.floor(9e4*Math.random())+1e5,n=(new Date).valueOf()+String(t);o.next_tablenbr=n,o.update_play_date(),o.upload_to_server({form:"new_wzq_dz_start",userid:o.userInfo.userid,nickName:o.userInfo.nickName,phonenum:o.userInfo.phonenum,avatarUrl:o.userInfo.avatarUrl,openid:o.userInfo.openid,card_id:o.card_id,shuijishu:n}),clearInterval(o.setTime),e.reLaunch({url:"../play_online/play_online?mulu_flag=ljms_hyyz&has_yaoqing_flag=true&player=1&shuijishu="+n})}}else a.cancel&&clearInterval(o.setTime)}});case 2:case"end":return a.stop()}},a,this)}));function t(e){return a.apply(this,arguments)}return t}(),wxGetUserInfo:function(a){var t=this;t.userInfo.hasLogin?t.start_play():(console.log(a.detail.userInfo),a.detail.userInfo?e.login({provider:"weixin",success:function(e){console.log("code:",e.code),t.login(a.detail.userInfo,e.code),t.upload_oauthData(a.detail.userInfo,e.code),t.start_play()}}):(console.log(333,"执行到这里，说明拒绝了授权"),e.showToast({title:"为了您更好的体验,请先同意授权",icon:"none",duration:2e3})))},upload_oauthData:function(a,t){var n=this;e.request({url:"https://kaikaiomg.applinzi.com/uni_app_upload.php",method:"POST",data:{form:"oauthData",userid:a.userid,nickName:a.nickName,avatarUrl:a.avatarUrl,city:a.city,country:a.country,gender:a.gender,language:a.language,province:a.province,code:t},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){200!==e.statusCode?console.log("请求失败:",e):(console.log("success_uodate_oauthData:",e.data[0]),n.setopenid(e.data[0].openid),n.setdbuserifo(e.data[0]))}})}})};a.default=c}).call(this,t("543d")["default"])},"7d50":function(e,a,t){"use strict";t.r(a);var n=t("7be1"),o=t.n(n);for(var l in n)"default"!==l&&function(e){t.d(a,e,function(){return n[e]})}(l);a["default"]=o.a},ae5e:function(e,a,t){"use strict";var n=t("1a65"),o=t.n(n);o.a},e2da:function(e,a,t){"use strict";t.r(a);var n=t("15f3"),o=t("7d50");for(var l in o)"default"!==l&&function(e){t.d(a,e,function(){return o[e]})}(l);t("ae5e");var r=t("2877"),i=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,null,null);a["default"]=i.exports}},[["5e7d","common/runtime","common/vendor"]]]);